# üì∏ –°–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤

–í—Å–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –≤–∏–¥–µ–æ –∏–∑ Telegram —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

```
public/
‚îî‚îÄ‚îÄ media/
    ‚îú‚îÄ‚îÄ photos/          # –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏–∑ –ø–æ—Å—Ç–æ–≤
    ‚îÇ   ‚îú‚îÄ‚îÄ photo_1234567890_abc123.jpg
    ‚îÇ   ‚îî‚îÄ‚îÄ photo_1234567891_def456.png
    ‚îî‚îÄ‚îÄ videos/          # –í–∏–¥–µ–æ –∏–∑ –ø–æ—Å—Ç–æ–≤
        ‚îú‚îÄ‚îÄ video_1234567890_abc123.mp4
        ‚îî‚îÄ‚îÄ video_1234567891_def456.webm
```

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

### –ù–æ–≤—ã–µ –ø–æ—Å—Ç—ã (—á–µ—Ä–µ–∑ Bot API)
–ö–æ–≥–¥–∞ –≤ Telegram –∫–∞–Ω–∞–ª –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ—Å—Ç —Å –º–µ–¥–∏–∞:
1. –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º –ø–æ—Å—Ç–µ
2. –°–∫–∞—á–∏–≤–∞–µ—Ç –º–µ–¥–∏–∞—Ñ–∞–π–ª —Å —Å–µ—Ä–≤–µ—Ä–æ–≤ Telegram
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ `public/media/photos/` –∏–ª–∏ `public/media/videos/`
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞: `{type}_{timestamp}_{random}.{ext}`
5. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ (—á–µ—Ä–µ–∑ Client API)
–ü—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–º–∞–Ω–¥–æ–π `npm run export-history`:
1. –°–∫–∞—á–∏–≤–∞—é—Ç—Å—è –≤—Å–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã –∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø–æ—Å—Ç–æ–≤
2. –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–µ—Ö –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
3. –í –∫–æ–Ω—Å–æ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–µ—Å—Å: `üì∑ –°–∫–∞—á–∞–Ω–æ —Ñ–æ—Ç–æ –¥–ª—è –ø–æ—Å—Ç–∞ 123`

## üé® –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- JPEG (.jpg)
- PNG (.png)
- GIF (.gif)
- WebP (.webp)

### –í–∏–¥–µ–æ
- MP4 (.mp4)
- WebM (.webm)
- MOV (.mov)
- MPEG (.mpeg)
- AVI (.avi)

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞–º:

```javascript
const { getMediaStats } = require('./utils/media-downloader');
const stats = getMediaStats();

console.log(stats);
// {
//   photos: { count: 150, size: 45678900, sizeFormatted: '43.56 MB' },
//   videos: { count: 20, size: 123456789, sizeFormatted: '117.74 MB' },
//   total: { count: 170, size: 169135689, sizeFormatted: '161.30 MB' }
// }
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### .gitignore
–ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã **–Ω–µ –∫–æ–º–º–∏—Ç—è—Ç—Å—è** –≤ git:
```gitignore
public/media/photos/
public/media/videos/
```

–≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—Ç:
- –ë–æ–ª—å—à–∏—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
- –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ —Å–ª–∏—è–Ω–∏–∏

### –î–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º
–§–∞–π–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä:
- `/media/photos/photo_1234567890_abc123.jpg`
- `/media/videos/video_1234567890_abc123.mp4`

Express –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑ `public/`.

## üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

–î–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```javascript
const fs = require('fs');
const path = require('path');
const { PHOTOS_DIR, VIDEOS_DIR } = require('./utils/media-downloader');

// –£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
const cleanOldMedia = (dir, days = 30) => {
    const now = Date.now();
    const maxAge = days * 24 * 60 * 60 * 1000;

    fs.readdirSync(dir).forEach(file => {
        const filepath = path.join(dir, file);
        const stats = fs.statSync(filepath);

        if (now - stats.mtimeMs > maxAge) {
            fs.unlinkSync(filepath);
            console.log(`–£–¥–∞–ª–µ–Ω: ${file}`);
        }
    });
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
cleanOldMedia(PHOTOS_DIR, 30);
cleanOldMedia(VIDEOS_DIR, 30);
```

## üì¶ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞
```bash
# Unix/Mac
tar -czf media-backup-$(date +%Y%m%d).tar.gz public/media/

# Windows
7z a media-backup-%date:~-4,4%%date:~-7,2%%date:~-10,2%.7z public/media/
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
# Unix/Mac
tar -xzf media-backup-20250101.tar.gz

# Windows
7z x media-backup-20250101.7z
```

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∂–∞—Ç–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sharp`:

```bash
npm install sharp
```

```javascript
const sharp = require('sharp');

async function compressImage(inputPath, outputPath) {
    await sharp(inputPath)
        .resize(1920, 1080, { fit: 'inside', withoutEnlargement: true })
        .jpeg({ quality: 85 })
        .toFile(outputPath);
}
```

### CDN
–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- Cloudflare (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π CDN)
- AWS S3 + CloudFront
- DigitalOcean Spaces

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω" –Ω–∞ —Å–∞–π—Ç–µ
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞: `ls public/media/photos/`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç—å –≤ –ë–î –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É

### –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã –Ω–µ —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Telegram API –¥–æ—Å—Ç—É–ø–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

### –ë–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
1. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (—Å–º. —Ä–∞–∑–¥–µ–ª "–û—á–∏—Å—Ç–∫–∞")
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (S3, Spaces)

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ EJS
```ejs
<% if (post.mediaType === 'photo' && post.mediaUrl) { %>
    <img src="<%= post.mediaUrl %>" alt="Post image" class="post-image">
<% } %>
```

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏–¥–µ–æ –≤ EJS
```ejs
<% if (post.mediaType === 'video' && post.mediaUrl) { %>
    <video controls class="post-video">
        <source src="<%= post.mediaUrl %>" type="video/mp4">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
    </video>
<% } %>
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `utils/media-downloader.js`:

```javascript
const MEDIA_DIR = path.join(__dirname, '..', 'public', 'uploads'); // –ò–∑–º–µ–Ω–∏—Ç—å
const PHOTOS_DIR = path.join(MEDIA_DIR, 'images'); // –ò–∑–º–µ–Ω–∏—Ç—å
const VIDEOS_DIR = path.join(MEDIA_DIR, 'clips'); // –ò–∑–º–µ–Ω–∏—Ç—å
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞
–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–∞–∑–º–µ—Ä–∞ –ø–µ—Ä–µ–¥ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º:

```javascript
async function downloadMedia(fileUrl, mediaType, maxSizeMB = 50) {
    const response = await axios.head(fileUrl);
    const sizeMB = parseInt(response.headers['content-length']) / (1024 * 1024);

    if (sizeMB > maxSizeMB) {
        console.log(`–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: ${sizeMB.toFixed(2)} MB`);
        return null;
    }

    // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ...
}
```

## üìö API

–°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –º–æ–¥—É–ª—è [utils/media-downloader.js](utils/media-downloader.js):

- `initMediaDirectories()` - —Å–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
- `downloadPhoto(url, mimeType)` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ
- `downloadVideo(url, mimeType)` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ
- `downloadMedia(url, type, mimeType)` - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
- `getMediaStats()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
